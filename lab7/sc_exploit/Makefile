CC=gcc
# Set the text and data sections to be readable and writable.
LDFLAGS=-Wl,--omagic 
# Donâ€™t produce a dynamically linked position independent executable.
LDFLAGS+=-no-pie
# Do not use the standard system startup files or libraries when linking
LDFLAGS+=-nostdlib

ASM_FILES=$(wildcard *.s)
SC_TGTS=$(ASM_FILES:.s=.sc)

all: $(SC_TGTS) $(SC_TGTS:.sc=.bin)

%.sc : %.bin
	objcopy -O binary --only-section=.text $< $@

%64.bin: %64.s
	$(CC) -m64 $(LDFLAGS) -o $@ $<

.PHONY: clean 

clean:
	rm -f $(SC_TGTS) *.sc *.bin *.o

